(this["webpackJsonpmedals-b-react"]=this["webpackJsonpmedals-b-react"]||[]).push([[0],{47:function(e,t,n){},76:function(e,t,n){},77:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),r=n(38),o=n.n(r),s=(n(47),n(17)),l=n(10),i=n.n(l),u=n(15),d=n(14),p=n(16),m=n.n(p),h=n(42),b=n(21),f=n(4),j=n(25),g=n(3),x=function(e){var t=e.medal,n=e.country,a=e.onIncrement,r=e.onDecrement,o=e.canPatch;return Object(g.jsxs)("div",{className:"medals",children:[t.name," Medals: ",n[t.name],o&&Object(g.jsxs)(c.a.Fragment,{children:[Object(g.jsx)("button",{onClick:function(){return a(n.id,t.name)},children:"+"}),Object(g.jsx)("button",{disabled:0===n[t.name],onClick:function(){return r(n.id,t.name)},children:"-"})]})]})},O=function(e){var t=e.country,n=e.medals,a=e.onIncrement,c=e.onDecrement,r=e.onDelete,o=e.canPatch,s=e.canDelete;return Object(g.jsxs)("div",{className:"country",children:[Object(g.jsxs)("div",{className:"name",children:[t.name,Object(g.jsx)("span",{className:"badge",children:function(e,t){var n=0;return t.forEach((function(t){n+=e[t.name]})),n}(t,n)})]}),n.map((function(e){return Object(g.jsx)(x,{country:t,medal:e,canPatch:o,onIncrement:a,onDecrement:c},e.id)})),s&&Object(g.jsx)("button",{onClick:function(){return r(t.id)},children:"delete"}),Object(g.jsx)("hr",{})]})},v=function(e){var t=e.onAdd;return Object(g.jsx)("div",{className:"newCountryButton",children:Object(g.jsx)("button",{onClick:function(){var e=prompt("Enter country name");e&&e.trim().length>0&&t(e)},children:"New Country"})})};var k=function(e){var t=e.onLogin,n=Object(a.useState)(""),c=Object(d.a)(n,2),r=c[0],o=c[1],s=Object(a.useState)(""),l=Object(d.a)(s,2),i=l[0],u=l[1],p=Object(f.e)();return Object(g.jsxs)("form",{className:"loginForm",onSubmit:function(e){return function(e){e.preventDefault(),console.log("Submit"),t(r,i),p.push("/")}(e)},children:[Object(g.jsxs)("p",{children:[Object(g.jsx)("label",{htmlFor:"username",children:"Username: "}),Object(g.jsx)("input",{onChange:function(e){return o(e.target.value)},value:r,autoFocus:!0,type:"text",name:"username",id:"username",placeholder:"Username"})]}),Object(g.jsxs)("p",{children:[Object(g.jsx)("label",{htmlFor:"password",children:"Password: "}),Object(g.jsx)("input",{onChange:function(e){return u(e.target.value)},value:i,type:"password",name:"password",id:"password",placeholder:"Password"})]}),Object(g.jsxs)("p",{children:[Object(g.jsx)("button",{disabled:0===r.length||0===i.length,type:"submit",children:"Submit"})," ",Object(g.jsx)("button",{onClick:function(){p.push("/")},type:"button",children:"Cancel"})]})]})},w=(n(76),function(){var e="https://medalsapi.azurewebsites.net/jwt/api/country",t=Object(a.useState)([]),n=Object(d.a)(t,2),c=n[0],r=n[1],o=Object(a.useState)(null),l=Object(d.a)(o,2),p=l[0],x=l[1],w=Object(a.useState)({name:null,canPost:!1,canPatch:!1,canDelete:!1}),y=Object(d.a)(w,2),P=y[0],D=y[1],I=Object(a.useRef)([{id:1,name:"gold"},{id:2,name:"silver"},{id:3,name:"bronze"}]),S=Object(a.useRef)(null);S.current=c,Object(a.useEffect)((function(){function t(){return(t=Object(u.a)(i.a.mark((function t(){var n,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m.a.get(e);case 2:n=t.sent,a=n.data,r(a);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}();var n=localStorage.getItem("token");n&&D(q(n));var a=(new h.a).withUrl("https://medalsapi.azurewebsites.net/medalsHub").withAutomaticReconnect().build();x(a)}),[]),Object(a.useEffect)((function(){p&&p.start().then((function(){console.log("Connected!"),p.on("ReceiveAddMessage",(function(e){console.log("Add: ".concat(e.name));var t=Object(s.a)(S.current);t=t.concat(e),r(t)})),p.on("ReceiveDeleteMessage",(function(e){console.log("Delete id: ".concat(e));var t=Object(s.a)(S.current);t=t.filter((function(t){return t.id!==e})),r(t)})),p.on("ReceivePatchMessage",(function(e){console.log("Patch: ".concat(e.name));var t=Object(s.a)(S.current),n=t.findIndex((function(t){return t.id===e.id}));t[n]=e,r(t)}))})).catch((function(e){return console.log("Connection failed: ",e)}))}),[p]);var C=function(){var t=Object(u.a)(i.a.mark((function t(n){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!A()){t.next=12;break}return console.log("valid"),t.prev=2,t.next=5,m.a.post(e,{name:n},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 5:t.next=10;break;case 7:t.prev=7,t.t0=t.catch(2),t.t0.response&&401===t.t0.response.status?alert("You are not authorized to complete this request"):t.t0.response?console.log(t.t0.response):console.log("Request failed");case 10:t.next=13;break;case 12:alert("Your token has expired");case 13:case"end":return t.stop()}}),t,null,[[2,7]])})));return function(e){return t.apply(this,arguments)}}(),N=function(){var t=Object(u.a)(i.a.mark((function t(n){var a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!A()){t.next=13;break}return a=c,r(c.filter((function(e){return e.id!==n}))),t.prev=3,t.next=6,m.a.delete("".concat(e,"/").concat(n),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(3),t.t0.response&&404===t.t0.response.status?console.log("The record does not exist - it may have already been deleted"):(r(a),t.t0.response&&401===t.t0.response.status?alert("You are not authorized to complete this request"):t.t0.response?console.log(t.t0.response):console.log("Request failed"));case 11:t.next=14;break;case 13:alert("Your token has expired");case 14:case"end":return t.stop()}}),t,null,[[3,8]])})));return function(e){return t.apply(this,arguments)}}(),z=function(e,t){return F(e,t,1)},R=function(e,t){return F(e,t,-1)},F=function(){var t=Object(u.a)(i.a.mark((function t(n,a,o){var l,u,d,p,h;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!A()){t.next=18;break}return l=c.findIndex((function(e){return e.id===n})),u=Object(s.a)(c),d=u[l][a],u[l][a]+=1*o,r(u),p=[{op:"replace",path:a,value:u[l][a]}],console.log("json patch for id: ".concat(n,": ").concat(JSON.stringify(p))),t.prev=8,t.next=11,m.a.patch("".concat(e,"/").concat(n),p,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(8),t.t0.response&&404===t.t0.response.status?console.log("The record does not exist - it may have been deleted"):t.t0.response&&401===t.t0.response.status?(alert("You are not authorized to complete this request"),(h=Object(s.a)(c))[l][a]=d,r(h)):t.t0.response?console.log(t.t0.response):console.log("Request failed");case 16:t.next=19;break;case 18:alert("Your token has expired");case 19:case"end":return t.stop()}}),t,null,[[8,13]])})));return function(e,n,a){return t.apply(this,arguments)}}(),L=function(){var e=Object(u.a)(i.a.mark((function e(t,n){var a,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m.a.post("https://medalsapi.azurewebsites.net/api/users/login",{username:t,password:n});case 3:a=e.sent,c=a.data.token,localStorage.setItem("token",c),D(q(c)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),!e.t0.response||401!==e.t0.response.status&&400!==e.t0.response.status?e.t0.response?console.log(e.t0.response):console.log("Request failed"):alert("Login failed");case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),A=function(){var e=localStorage.getItem("token");if(e){var t=Object(j.a)(e),n=Date.now()-1e3*t.exp;if(n<0)return console.log("token expires in ".concat(parseInt(-1*n/6e4)," minutes")),!0;console.log("token expired ".concat(parseInt(n/6e4)," minutes ago")),localStorage.removeItem("token"),D({name:null,canPost:!1,canPatch:!1,canDelete:!1})}return!1},q=function(e){var t=Object(j.a)(e),n=Date.now()-1e3*t.exp;return n<0?(console.log("token expires in ".concat(parseInt(-1*n/6e4)," minutes")),{name:t.username,canPost:-1!==t.roles.indexOf("medals-post"),canPatch:-1!==t.roles.indexOf("medals-patch"),canDelete:-1!==t.roles.indexOf("medals-delete")}):(console.log("token expired ".concat(parseInt(n/6e4)," minutes ago")),localStorage.removeItem("token"),{name:null,canPost:!1,canPatch:!1,canDelete:!1})};return Object(g.jsxs)(b.a,{children:[Object(g.jsxs)("div",{className:"appHeading",children:["Olympic Medals",Object(g.jsx)("span",{className:"badge",children:function(){var e=0;return I.current.forEach((function(t){e+=c.reduce((function(e,n){return e+n[t.name]}),0)})),e}()}),P.name?Object(g.jsxs)("span",{className:"logout",children:[Object(g.jsx)("a",{href:"/",onClick:function(e){return e.preventDefault(),console.log("logout"),localStorage.removeItem("token"),D({name:null,canPost:!1,canPatch:!1,canDelete:!1}),!1},className:"logoutLink",children:"Logout"})," [",P.name,"]"]}):Object(g.jsx)(b.b,{to:"/login",className:"loginLink",children:"Login"})]}),Object(g.jsx)(f.a,{exact:!0,path:"/login",children:Object(g.jsx)(k,{onLogin:L})}),Object(g.jsx)("div",{className:"countries",children:c.map((function(e){return Object(g.jsx)(O,{country:e,medals:I.current,canPatch:P.canPatch,canDelete:P.canDelete,onDelete:N,onIncrement:z,onDecrement:R},e.id)}))}),P.canPost&&Object(g.jsx)(v,{onAdd:C})]})}),y=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,78)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,o=t.getTTFB;n(e),a(e),c(e),r(e),o(e)}))};o.a.render(Object(g.jsx)(c.a.StrictMode,{children:Object(g.jsx)(w,{})}),document.getElementById("root")),y()}},[[77,1,2]]]);
//# sourceMappingURL=main.f902e1d5.chunk.js.map